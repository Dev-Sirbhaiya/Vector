(()=>{"use strict";var t;!function(t){t.PROCESS_COMMAND="PROCESS_COMMAND",t.COMMAND_RESULT="COMMAND_RESULT",t.GET_DOM_CONTEXT="GET_DOM_CONTEXT",t.DOM_CONTEXT_RESPONSE="DOM_CONTEXT_RESPONSE",t.EXECUTE_ACTION="EXECUTE_ACTION",t.ACTION_RESULT="ACTION_RESULT",t.CLARIFICATION_NEEDED="CLARIFICATION_NEEDED",t.CLARIFICATION_RESPONSE="CLARIFICATION_RESPONSE",t.GET_SETTINGS="GET_SETTINGS",t.SETTINGS_RESPONSE="SETTINGS_RESPONSE",t.SETTINGS_UPDATED="SETTINGS_UPDATED",t.STATUS_UPDATE="STATUS_UPDATE",t.ERROR="ERROR",t.PING="PING",t.PONG="PONG"}(t||(t={}));const e=5e3,n=200,i=["a[href]","button","input","select","textarea",'[role="button"]','[role="link"]','[role="checkbox"]','[role="radio"]','[role="menuitem"]','[role="tab"]','[role="switch"]','[role="option"]',"[onclick]",'[tabindex]:not([tabindex="-1"])','[class*="btn" i]','[class*="button" i]','[class*="link" i]','[class*="clickable" i]','[class*="action" i]','[id*="btn" i]','[id*="button" i]'].join(",");function o(){const t=function(){const t=[],e=new Set;let n=0;return document.body.querySelectorAll(i).forEach(i=>{if(e.has(i))return;const o=r(i,n++,!0);o&&(t.push(o),e.add(i))}),document.body.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(i=>{if(e.has(i))return;const o=r(i,n++,!1);o&&(t.push(o),e.add(i))}),document.body.querySelectorAll("main,article,section,nav,header,footer,aside,form").forEach(i=>{if(e.has(i))return;const o=r(i,n++,!1);o&&(t.push(o),e.add(i))}),function(t){const e=window.innerWidth*window.innerHeight;t.forEach(t=>{let n=0;var i;t.isInteractive&&(n+=.3),(i=t.viewportBounds).x<window.innerWidth&&i.x+i.width>0&&i.y<window.innerHeight&&i.y+i.height>0&&(n+=.2),/^h[1-6]$/.test(t.tag)&&(n+=.2+.1*(7-parseInt(t.tag[1]))),t.text&&t.text.length>0&&(n+=.1);const o=t.bounds.width*t.bounds.height;o>.01*e&&o<.5*e&&(n+=.1),["main","article","section","nav","header","footer","aside"].includes(t.tag)&&(n+=.15),t.importance=Math.min(1,n)})}(t),t}(),n=function(){const t=[],n=new Set,i=['[class*="card"]','[class*="Card"]','[class*="tile"]','[class*="Tile"]',"li",'[class*="item"]','[class*="Item"]','[class*="product"]','[class*="Product"]','[class*="job"]','[class*="Job"]','[class*="posting"]','[class*="Posting"]',"article",'[class*="article"]','[class*="post"]','[class*="Post"]','[class*="result"]','[class*="Result"]',"tr","[data-id]","[data-item-id]","[data-product-id]"];for(const o of i){if(t.length>=100)break;try{const i=document.querySelectorAll(o);for(const o of i){if(t.length>=100)break;if(n.has(o))continue;const i=o.getBoundingClientRect();if(i.width<50||i.height<30)continue;if(i.width>.95*window.innerWidth&&i.height>.9*window.innerHeight)continue;const r=o.querySelector("a, button, input"),s=i.width*i.height<window.innerWidth*window.innerHeight*.5;let a=!1;if(s){const t=o,n=t.innerText?.trim().length||0;a=n>10&&n<e}if(!a&&!r)continue;n.add(o);const c=g(o);c&&t.push(c)}}catch{}}return t}(),o=function(t){const e={};return Object.entries({header:["header",'[role="banner"]'],navigation:["nav",'[role="navigation"]'],main:["main",'[role="main"]'],sidebar:["aside",'[role="complementary"]'],footer:["footer",'[role="contentinfo"]']}).forEach(([n,i])=>{const o=document.querySelector(i.join(","));if(o){const i=o.getBoundingClientRect();e[n]={element:o,bounds:{x:i.x,y:i.y,width:i.width,height:i.height},elements:t.filter(t=>o.contains(t.element))}}}),e}(t),a=function(t,e){const n=new Map,i=t.filter(t=>t.isInteractive&&function(t){const e=t.getBoundingClientRect();if(0===e.width||0===e.height)return!1;const n=window.getComputedStyle(t);return"none"!==n.display&&"hidden"!==n.visibility}(t.element)),o=i.map(o=>{n.set(o.id,o.element);const r=i.filter(t=>t.id!==o.id&&h(o.bounds,t.bounds)<200).sort((t,e)=>h(o.bounds,t.bounds)-h(o.bounds,e.bounds)).slice(0,5).map(t=>({id:t.id,text:(t.text||"").substring(0,50),direction:d(o.bounds,t.bounds),distance:Math.round(h(o.bounds,t.bounds))})),a=function(t,e){let n=null,i=null,o=t.element.parentElement;for(;o&&o!==document.body;){const t=o.tagName.toLowerCase();if(["section","article","nav","aside","main","header","footer","form"].includes(t)){n=t,i=o.getAttribute("aria-label")||o.id||null;break}o=o.parentElement}return{parentSection:n,parentSectionLabel:i,siblings:e.filter(e=>e.id!==t.id&&e.isInteractive&&e.element.parentElement===t.element.parentElement).slice(0,5).map(t=>({id:t.id,text:(t.text||"").substring(0,30)}))}}(o,t);let c;for(const t of e)if(t.element.contains(o.element)){const e=t.interactiveElements.find(t=>t.element===o.element),n=e?.type||"action";c={containerType:t.containerType,title:t.title?.text||null,buttonPurpose:n,associationText:b(o.text||o.tag,t.title?.text||"this item",n,t.metadata?.price)};break}return{id:o.id,tagName:o.tag,role:o.role,text:(o.text||"").slice(0,100),attributes:{id:o.element.id||void 0,className:s(o.element)||void 0,href:o.element.getAttribute("href")||void 0,type:o.element.getAttribute("type")||void 0,placeholder:o.element.getAttribute("placeholder")||void 0,ariaLabel:o.element.getAttribute("aria-label")||void 0,name:o.element.getAttribute("name")||void 0},isInteractive:!0,isVisible:!0,boundingBox:{x:Math.round(o.bounds.x),y:Math.round(o.bounds.y),width:Math.round(o.bounds.width),height:Math.round(o.bounds.height)},importance:o.importance,relativePosition:u(o.viewportBounds),region:l(o.viewportBounds),nearbyElements:r,semanticContext:{parentSection:a.parentSection,parentSectionLabel:a.parentSectionLabel,siblings:a.siblings},contentFor:c,actionHint:m(o)}});return window.__aiAgentElementMap=n,o}(t,n),c=function(t,e){const n=t.filter(t=>t.isInteractive),i=t.filter(t=>/^h[1-6]$/.test(t.tag));let o=`Page: "${document.title}"\n`;return o+=`Type: ${w()}\n\n`,o+="STRUCTURE:\n",e.header&&(o+=`- Header at top (0-${Math.round(e.header.bounds.height)}px)\n`),e.navigation&&(o+="- Navigation menu present\n"),e.main&&(o+=`- Main content area (${Math.round(e.main.bounds.width)}x${Math.round(e.main.bounds.height)}px)\n`),e.sidebar&&(o+=`- Sidebar on ${e.sidebar.bounds.x<window.innerWidth/2?"left":"right"}\n`),e.footer&&(o+="- Footer at bottom\n"),o+="\nCONTENT OVERVIEW:\n",o+=`- ${i.length} headings\n`,o+=`- ${n.length} interactive elements\n`,o+=`- ${n.filter(t=>"a"===t.tag).length} links\n`,o+=`- ${n.filter(t=>"button"===t.tag).length} buttons\n`,o+=`- ${n.filter(t=>"input"===t.tag).length} input fields\n`,{text:o,stats:{totalElements:t.length,interactiveElements:n.length,headings:i.length,landmarks:Object.keys(e).length},landmarks:Object.keys(e)}}(t,o),p=function(t){const e=window.innerWidth,n=window.innerHeight,i={"top-left":{x:0,y:0,width:e/3,height:n/3},"top-center":{x:e/3,y:0,width:e/3,height:n/3},"top-right":{x:e/3*2,y:0,width:e/3,height:n/3},"middle-left":{x:0,y:n/3,width:e/3,height:n/3},"middle-center":{x:e/3,y:n/3,width:e/3,height:n/3},"middle-right":{x:e/3*2,y:n/3,width:e/3,height:n/3},"bottom-left":{x:0,y:n/3*2,width:e/3,height:n/3},"bottom-center":{x:e/3,y:n/3*2,width:e/3,height:n/3},"bottom-right":{x:e/3*2,y:n/3*2,width:e/3,height:n/3}},o={};Object.entries(i).forEach(([e,n])=>{const i=t.filter(t=>{const e=t.viewportBounds.x+t.viewportBounds.width/2,i=t.viewportBounds.y+t.viewportBounds.height/2;return e>=n.x&&e<n.x+n.width&&i>=n.y&&i<n.y+n.height}).filter(t=>t.isInteractive);o[e]={interactiveCount:i.length,description:`${e.replace("-"," ")} region with ${i.length} interactive elements`}});let r="SPATIAL LAYOUT GRID:\n\n";const s=["left","center","right"];return["top","middle","bottom"].forEach(t=>{let e="";s.forEach(n=>{const i=o[`${t}-${n}`]?.interactiveCount||0;e+=(i>0?`[${i}]`:"[ ]").padEnd(6)}),r+=e+"\n"}),r+="\n[N] = N interactive elements in region\n",{regions:o,textRepresentation:r}}(t),f=function(t,e){const n=t.filter(t=>t.isInteractive),i=[];i.push({step:0,type:"overview",description:`The page "${document.title}" has ${n.length} interactive elements.`});let o=1;if(e.header){const t=e.header.elements.filter(t=>t.isInteractive).length;i.push({step:o++,type:"landmark",description:`HEADER (top): Contains ${t} interactive elements including navigation and branding.`})}if(e.navigation){const t=e.navigation.elements.filter(t=>"a"===t.tag).length;i.push({step:o++,type:"landmark",description:`NAVIGATION: Main menu with ${t} links.`})}if(e.main&&i.push({step:o++,type:"landmark",description:"MAIN CONTENT: Primary page content area."}),e.sidebar){const t=e.sidebar.bounds.x<window.innerWidth/2?"left":"right";i.push({step:o++,type:"landmark",description:`SIDEBAR (${t} side): Secondary content and navigation.`})}if(e.footer){const t=e.footer.elements.filter(t=>t.isInteractive).length;i.push({step:o++,type:"landmark",description:`FOOTER (bottom): Contains ${t} links and information.`})}return i}(t,o),E=function(t){return t.filter(t=>t.interactiveElements.length>0).slice(0,100).map(t=>({containerType:t.containerType,title:t.title?.text||null,subtitle:t.subtitle?.text||null,fullDescription:t.fullDescription,actions:t.interactiveElements.slice(0,10).map(e=>({text:e.text.substring(0,50),purpose:e.type,description:b(e.text||e.tag,t.title?.text||"this item",e.type,t.metadata?.price)}))}))}(n);return{url:window.location.href,title:document.title,timestamp:Date.now(),elements:a,pageText:((document.querySelector('main, article, [role="main"]')||document.body).innerText||"").slice(0,2e3),pageSummary:c,spatialGrid:p,contentContainers:E,navigationGuide:f,pageType:w(),primaryAction:y(),viewport:{width:window.innerWidth,height:window.innerHeight},documentSize:{width:document.documentElement.scrollWidth,height:document.documentElement.scrollHeight}}}function r(t,e,n){const i=t.getBoundingClientRect();if(0===i.width&&0===i.height)return null;const o=t.tagName.toLowerCase();return["script","style","noscript","meta","link"].includes(o)?null:{id:`el-${e}`,element:t,tag:o,text:c(t),bounds:{x:i.x+window.scrollX,y:i.y+window.scrollY,width:i.width,height:i.height,centerX:i.x+i.width/2+window.scrollX,centerY:i.y+i.height/2+window.scrollY},viewportBounds:{x:i.x,y:i.y,width:i.width,height:i.height},isInteractive:n,role:t.getAttribute("role")||a(t),importance:0}}function s(t){const e=t.className;return"string"==typeof e?e:e&&"string"==typeof e.baseVal?e.baseVal:""}function a(t){return{a:"link",button:"button",input:"textbox",select:"combobox",textarea:"textbox",nav:"navigation",main:"main",header:"banner",footer:"contentinfo",aside:"complementary",form:"form",h1:"heading",h2:"heading",h3:"heading",h4:"heading",h5:"heading",h6:"heading"}[t.tagName.toLowerCase()]||null}function c(t){const e=t.getAttribute("aria-label");if(e)return e.substring(0,n);const i=t;if(i.value)return i.value.substring(0,n);const o=t;if(o.alt)return o.alt.substring(0,n);const r=t.getAttribute("title");if(r)return r.substring(0,n);const s=t;if(s.innerText){const t=s.innerText.trim();return t?t.substring(0,n):null}return null}function l(t){const e=window.innerWidth,n=window.innerHeight,i=t.x+t.width/2,o=t.y+t.height/2;return`${o<n/3?"top":o>n/3*2?"bottom":"middle"}-${i<e/3?"left":i>e/3*2?"right":"center"}`}function u(t){const e=window.innerWidth,n=window.innerHeight,i=t.x+t.width/2,o=t.y+t.height/2;let r=o<.2*n?"at the top":o>.8*n?"at the bottom":"in the middle";return r+=i<.3*e?", on the left side":i>.7*e?", on the right side":", in the center",r}function d(t,e){const n=e.x+e.width/2-(t.x+t.width/2),i=e.y+e.height/2-(t.y+t.height/2),o=180*Math.atan2(i,n)/Math.PI;return o>-22.5&&o<=22.5?"right":o>22.5&&o<=67.5?"bottom-right":o>67.5&&o<=112.5?"below":o>112.5&&o<=157.5?"bottom-left":o>157.5||o<=-157.5?"left":o>-157.5&&o<=-112.5?"top-left":o>-112.5&&o<=-67.5?"above":o>-67.5&&o<=-22.5?"top-right":"nearby"}function h(t,e){const n=t.x+t.width/2-(e.x+e.width/2),i=t.y+t.height/2-(e.y+e.height/2);return Math.sqrt(n*n+i*i)}function m(t){const e=t.tag,n=t.element?.type;return"a"===e?"click to navigate":"button"===e?"click to activate":"input"===e?"submit"===n?"click to submit":"checkbox"===n?"click to toggle":"radio"===n?"click to select":"click and type":"select"===e?"click to open dropdown":"textarea"===e?"click and type":"click"}function g(t){const n=t.getBoundingClientRect(),i=function(t){const e=["h1","h2","h3","h4","h5","h6",'[class*="title"]','[class*="Title"]','[class*="heading"]','[class*="Heading"]','[class*="name"]','[class*="Name"]',"a[href]:first-of-type","strong:first-of-type"];for(const n of e){const e=t.querySelector(n);if(e){const t=e.innerText?.trim();if(t&&t.length>2&&t.length<200)return{element:e,text:t}}}return null}(t),o=function(t,e){const n=['[class*="subtitle"]','[class*="Subtitle"]','[class*="description"]','[class*="Description"]','[class*="summary"]','[class*="Summary"]','[class*="meta"]','[class*="info"]',"p:first-of-type",'span[class*="company"]','span[class*="location"]'];for(const i of n){const n=t.querySelector(i);if(n&&n!==e){const t=n.innerText?.trim();if(t&&t.length>2&&t.length<300)return{element:n,text:t}}}return null}(t,i?.element??null),r=Array.from(t.querySelectorAll('a, button, input, select, textarea, [role="button"], [onclick]')).slice(0,20).map(t=>({element:t,tag:t.tagName.toLowerCase(),text:t.innerText?.trim().substring(0,100)||t.value||t.getAttribute("aria-label")||"",type:p(t)})),a=function(t){const n={},i=t.getBoundingClientRect();let o="";if(i.width*i.height>window.innerWidth*window.innerHeight*.3||(o=t.innerText||"",o.length>e&&(o=o.substring(0,e))),o.length>0&&o.length<e){const t=o.match(/\$[\d,]+\.?\d*|\d+\.?\d*\s*(USD|EUR|GBP|£|€)/i);t&&(n.price=t[0])}for(const e of["time",'[class*="date"]',"[datetime]"]){const i=t.querySelector(e);if(i){n.date=i.getAttribute("datetime")||i.innerText?.trim()||"";break}}for(const e of['[class*="location"]','[class*="Location"]','[class*="address"]']){const i=t.querySelector(e);if(i&&i.innerText?.trim()){n.location=i.innerText.trim().substring(0,100);break}}for(const e of['[class*="company"]','[class*="author"]','[class*="Author"]','[class*="brand"]']){const i=t.querySelector(e);if(i&&i.innerText?.trim()){n.author=i.innerText.trim().substring(0,100);break}}for(const e of['[class*="rating"]','[class*="Rating"]','[class*="stars"]','[class*="score"]']){const i=t.querySelector(e);if(i){const t=i.innerText?.trim()||i.getAttribute("aria-label");if(t){n.rating=t.substring(0,50);break}}}return Object.keys(n).length>0?n:null}(t),c=function(t,e){const n=s(t).toLowerCase();return n.includes("job")||n.includes("posting")||n.includes("career")?"job-posting":n.includes("product")||e?.price?"product":n.includes("article")||n.includes("post")||n.includes("blog")?"article":n.includes("video")||t.querySelector('video, [class*="video"]')?"video":n.includes("user")||n.includes("profile")||n.includes("person")?"profile":n.includes("comment")||n.includes("review")?"comment":n.includes("result")||n.includes("search")?"search-result":n.includes("notification")||n.includes("alert")?"notification":n.includes("message")||n.includes("chat")?"message":"content-item"}(t,a);return{element:t,bounds:{x:n.x+window.scrollX,y:n.y+window.scrollY,width:n.width,height:n.height},title:i,subtitle:o,metadata:a,interactiveElements:r,containerType:c,fullDescription:f(i,o,a)}}function p(t){const e=(t.innerText?.trim()||t.value||t.getAttribute("aria-label")||"").toLowerCase();return/apply|submit application/i.test(e)?"apply":/save|bookmark|favorite/i.test(e)?"save":/share/i.test(e)?"share":/buy|purchase|add to cart|add to bag/i.test(e)?"purchase":/subscribe|follow/i.test(e)?"subscribe":/like|upvote|heart/i.test(e)?"like":/delete|remove/i.test(e)?"delete":/edit|modify/i.test(e)?"edit":/view|details|more|read/i.test(e)?"view-details":/play/i.test(e)?"play":/download/i.test(e)?"download":/close|dismiss|cancel/i.test(e)?"close":"action"}function f(t,e,n){let i=t?.text||"Unknown item";if(e?.text&&(i+=` - ${e.text}`),n){const t=[];n.author&&t.push(n.author),n.location&&t.push(n.location),n.price&&t.push(n.price),n.date&&t.push(n.date),t.length>0&&(i+=` (${t.join(", ")})`)}return i}function b(t,e,n,i){switch(n){case"apply":return`"${t}" button to apply for: ${e}`;case"purchase":return`"${t}" button to buy: ${e}${i?` (${i})`:""}`;case"save":return`"${t}" button to save: ${e}`;case"subscribe":return`"${t}" button to subscribe to: ${e}`;case"view-details":return`"${t}" link to view details of: ${e}`;case"like":return`"${t}" button to like: ${e}`;case"share":return`"${t}" button to share: ${e}`;case"delete":return`"${t}" button to delete: ${e}`;case"play":return`"${t}" button to play: ${e}`;default:return`"${t}" for: ${e}`}}function w(){if(document.querySelector('[class*="login"], [class*="signin"], form[action*="login"]'))return"login";if(document.querySelector('[class*="signup"], [class*="register"]'))return"registration";if(document.querySelector('[class*="cart"], [class*="checkout"]'))return"checkout";if(document.querySelectorAll('[class*="product"], [class*="item"], [data-product]').length>3)return"product-listing";if(document.querySelectorAll("article").length>0)return"article/blog";const t=document.querySelectorAll("form"),e=document.querySelectorAll("input");return 1===t.length&&e.length>3?"form":document.querySelector('[class*="search"]')?"search":"general"}function y(){const t=Array.from(document.querySelectorAll('button, [role="button"], input[type="submit"]')),e=/submit|sign|login|register|buy|add|create|start|continue|next|confirm/i;for(const n of t){const t=n.textContent||n.value||"";if(e.test(t))return{text:t.trim(),type:n.tagName.toLowerCase()}}return null}function E(t,e){x(t);const n=document.createElement("style");return n.id=t,n.textContent=e,document.head.appendChild(n),{success:!0,data:{styleId:t}}}function x(t){document.getElementById(t)?.remove()}chrome.runtime.onMessage.addListener((e,n,i)=>(async function(e){switch(console.log("[Content] Received message:",e.type),e.type){case t.PING:return{success:!0,data:"pong"};case t.GET_DOM_CONTEXT:return function(){try{return{success:!0,data:o()}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Failed to parse DOM"}}}();case t.EXECUTE_ACTION:return async function(t){try{const{type:e,target:n,value:i}=t;switch(e){case"click":return function(t){const e=window.__aiAgentElementMap;let n=e?.get(t);if(n||(n=document.querySelector(t)),!n)return{success:!1,error:`Element not found: ${t}`};n.scrollIntoView({behavior:"smooth",block:"center"});const i=n,o=i.style.outline;return i.style.outline="3px solid #4CAF50",setTimeout(()=>{i.style.outline=o,i.click()},300),{success:!0,data:{clicked:t}}}(n);case"fill":return function(t,e){const n=window.__aiAgentElementMap;let i=n?.get(t)||document.querySelector(t);return i?i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement?(i.focus(),i.value=e,i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})),{success:!0,data:{filled:t,value:e}}):{success:!1,error:"Element is not a form field"}:{success:!1,error:`Element not found: ${t}`}}(n,i);case"scroll":return function(t){const e="string"==typeof t?t:t?.direction,n=t?.amount||400;switch(e){case"down":window.scrollBy({top:n,behavior:"smooth"});break;case"up":window.scrollBy({top:-n,behavior:"smooth"});break;case"top":window.scrollTo({top:0,behavior:"smooth"});break;case"bottom":window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"});break;default:return{success:!1,error:`Unknown scroll direction: ${e}`}}return{success:!0,data:{scrolled:e}}}(i);case"modify":return function(t){const{type:e,selector:n,scale:i,enabled:o}=t;switch(e){case"enlarge-text":return E("ai-agent-enlarge",`\n        ${n||"body"} { font-size: ${i||1.5}em !important; }\n      `);case"bold-text":return E("ai-agent-bold",`\n        ${n||"body"} p, ${n||"body"} span { font-weight: 600 !important; }\n      `);case"high-contrast":return!1!==o?E("ai-agent-contrast","\n          body { filter: contrast(1.2) !important; }\n          a { color: #0000EE !important; text-decoration: underline !important; }\n        "):(x("ai-agent-contrast"),{success:!0});case"highlight-links":return!1!==o?E("ai-agent-links","\n          a[href] { background-color: rgba(255,255,0,0.3) !important; padding: 2px 4px !important; }\n        "):(x("ai-agent-links"),{success:!0});case"reset":return document.querySelectorAll('style[id^="ai-agent-"]').forEach(t=>t.remove()),{success:!0,data:{reset:!0}};default:return{success:!1,error:`Unknown modification type: ${e}`}}}(i);default:return{success:!1,error:`Unknown action type: ${e}`}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Action execution failed"}}}(e.payload);default:return{success:!1,error:`Unknown message type: ${e.type}`}}}(e).then(i).catch(t=>{console.error("[Content] Message handling error:",t),i({success:!1,error:t instanceof Error?t.message:"Unknown error"})}),!0)),console.log("[AI Browser Agent] Content script loaded")})();